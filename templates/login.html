{% extends "base.html" %}

{% block title %}Ingresar · BigData MPBM{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<style>
  .auth-wrap {
    min-height: calc(100vh - 120px);
    display: grid;
    place-items: center;
    padding: 2rem 1rem;
  }
  .glass-card {
    width: 100%;
    max-width: 880px;
    background: rgba(15, 23, 42, 0.65);
    border: 1px solid rgba(148,163,184,.25);
    box-shadow: 0 20px 45px rgba(0,0,0,.55);
    border-radius: 22px;
    color: #e2e8f0;
    overflow: hidden;
  }
  .left-pane { padding: 2rem; }
  .right-pane {
    background: linear-gradient(135deg, rgba(59,130,246,.18), rgba(236,72,153,.18));
    border-left: 1px solid rgba(148,163,184,.25);
    padding: 2rem;
  }
  .brand-title {
    font-size: 1.9rem;
    font-weight: 700;
    letter-spacing: .2px;
    margin-bottom: .25rem;
  }
  .brand-sub { color: #cbd5e1; font-size: .95rem; margin-bottom: 1.5rem; }
  .form-label { color: #cbd5e1; }
  .form-control {
    background: rgba(2,6,23,.35);
    color: #e2e8f0;
    border: 1px solid rgba(148,163,184,.35);
  }
  .form-control:focus {
    background: rgba(2,6,23,.45);
    color: #fff;
    border-color: #60a5fa;
    box-shadow: 0 0 0 .2rem rgba(96,165,250,.25);
  }
  .btn-primary { border-radius: 10px; padding: .75rem 1.2rem; }
  .muted { color: #94a3b8; font-size: .9rem; }
  .divider { height: 1px; background: rgba(148,163,184,.2); margin: 1.2rem 0; }
  #div_cargando { display:none; }
</style>
{% endblock %}

{% block content %}

<div class="auth-wrap container">
  <div class="glass-card row g-0">
    <!-- LEFT -->
    <div class="col-12 col-lg-6 left-pane">
      <div class="d-flex align-items-center gap-2 mb-2">
        <i class="bi bi-shield-lock-fill fs-4 text-primary"></i>
        <div>
          <div class="brand-title">Ingresar</div>
          <div class="brand-sub">Autenticación segura para el panel de administración</div>
        </div>
      </div>

      {% if error_message %}
      <div class="alert alert-danger" role="alert">
        {{ error_message }}
      </div>
      {% endif %}

      <form method="POST" action="{{ url_for('login') }}" id="loginForm" onsubmit="return mostrarCargando()">
        <div class="mb-3">
          <label for="usuario" class="form-label">Usuario</label>
          <input type="text" class="form-control" id="usuario" name="usuario" required autocomplete="username">
        </div>

        <div class="mb-3">
          <label for="password" class="form-label">Contraseña</label>
          <div class="input-group">
            <input type="password" class="form-control" id="password" name="password" required autocomplete="current-password">
            <button type="button" class="btn btn-outline-secondary" onclick="togglePassword()" aria-label="Mostrar/Ocultar contraseña">
              <i id="eyeIcon" class="bi bi-eye"></i>
            </button>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="remember">
            <label class="form-check-label muted" for="remember">Recordarme en este equipo</label>
          </div>
          <a class="helper-link" href="#" onclick="alert('Función opcional');return false;">¿Olvidaste tu contraseña?</a>
        </div>

        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-box-arrow-in-right me-1"></i> Ingresar
          </button>
        </div>

        <div class="divider"></div>
        <p class="muted mb-0">
          Acceso restringido. Necesitas un rol con permiso <code>login</code>.
        </p>
      </form>
    </div>

    <!-- RIGHT -->
    <div class="col-12 col-lg-6 right-pane d-flex flex-column justify-content-between">
      <div>
        <h4 class="fw-bold mb-2">Proyecto BigData MPBM</h4>
        <p class="mb-3">Gestión de datos con <b>MongoDB</b> y búsqueda avanzada con <b>ElasticSearch</b>.</p>
        <ul class="mb-3">
          <li>Control de acceso por roles</li>
          <li>Panel de administración</li>
          <li>Indexación y consulta de documentos</li>
        </ul>
      </div>

      <div class="text-center">
        <!-- MISMA RUTA DE LA FOTO -->
        <img src="{{ url_for('static', filename='Images/creador.png') }}"
             alt="María Paula Barrero"
             style="width:180px;height:180px;border-radius:50%;object-fit:cover;border:3px solid rgba(255,255,255,.25);box-shadow:0 0 18px rgba(255,255,255,.18);">
        <p class="mt-3 mb-0 muted">Creado por {{ creador }} · v{{ version }}</p>
      </div>
    </div>
  </div>

  <div id="div_cargando" class="text-center mt-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2">Procesando su solicitud...</p>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
  function togglePassword() {
    const input = document.getElementById('password');
    const eye = document.getElementById('eyeIcon');
    if (input.type === 'password') {
      input.type = 'text';
      eye.className = 'bi bi-eye-slash';
    } else {
      input.type = 'password';
      eye.className = 'bi bi-eye';
    }
  }

  function mostrarCargando() {
    const btn = document.querySelector('button[type="submit"]');
    if (btn) btn.disabled = true;
    document.getElementById('div_cargando').style.display = 'block';
    return true;
  }
</script>
{% endblock %}